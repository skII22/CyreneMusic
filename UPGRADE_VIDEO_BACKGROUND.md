# è§†é¢‘èƒŒæ™¯å‡çº§è¯´æ˜

## ğŸ“ æ›´æ–°å†…å®¹

å·²æˆåŠŸå°†çª—å£èƒŒæ™¯å’Œæ’­æ”¾å™¨èƒŒæ™¯å‡çº§ä¸ºæ”¯æŒ **MP4 è§†é¢‘å’Œå¸¸è§å›¾ç‰‡æ ¼å¼**çš„è‡ªå®šä¹‰èƒŒæ™¯ã€‚

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. **æ”¯æŒçš„åª’ä½“æ ¼å¼**

#### å›¾ç‰‡æ ¼å¼
- JPG/JPEG
- PNG
- GIF
- BMP
- WebP

#### è§†é¢‘æ ¼å¼
- MP4
- MOV
- AVI
- MKV
- WebM
- M4V

### 2. **æ”¯æŒçš„èƒŒæ™¯ç±»å‹**

#### çª—å£èƒŒæ™¯ï¼ˆèµåŠ©ç”¨æˆ·ç‹¬äº«ï¼‰
- âœ… å›¾ç‰‡èƒŒæ™¯
- âœ… è§†é¢‘èƒŒæ™¯ï¼ˆå¾ªç¯æ’­æ”¾ï¼Œè‡ªåŠ¨é™éŸ³ï¼‰
- âœ… å¯è°ƒèŠ‚æ¨¡ç³Šç¨‹åº¦ï¼ˆ0-50ï¼‰
- âœ… å¯è°ƒèŠ‚ä¸é€æ˜åº¦ï¼ˆ0-100%ï¼‰

#### æ’­æ”¾å™¨èƒŒæ™¯ï¼ˆèµåŠ©ç”¨æˆ·ç‹¬äº«å›¾ç‰‡/è§†é¢‘ï¼‰
- âœ… è‡ªé€‚åº”èƒŒæ™¯ï¼ˆåŸºäºå°é¢æå–é¢œè‰²ï¼‰
- âœ… çº¯è‰²èƒŒæ™¯
- âœ… å›¾ç‰‡èƒŒæ™¯
- âœ… è§†é¢‘èƒŒæ™¯ï¼ˆå¾ªç¯æ’­æ”¾ï¼Œè‡ªåŠ¨é™éŸ³ï¼‰
- âœ… å¯è°ƒèŠ‚æ¨¡ç³Šç¨‹åº¦ï¼ˆ0-50ï¼‰

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### è·¨å¹³å°è§†é¢‘æ’­æ”¾å™¨

ä¸ºäº†ç¡®ä¿æ‰€æœ‰å¹³å°éƒ½èƒ½æ­£å¸¸æ’­æ”¾è§†é¢‘ï¼Œé‡‡ç”¨äº†åŒå¼•æ“æ–¹æ¡ˆï¼š

#### æ¡Œé¢å¹³å°ï¼ˆWindows/macOS/Linuxï¼‰
- **ä½¿ç”¨æ’ä»¶**: `media_kit` + `media_kit_video`
- **ä¼˜åŠ¿**: 
  - å®Œç¾æ”¯æŒ Windows å¹³å°
  - é«˜æ€§èƒ½ï¼Œä½èµ„æºå ç”¨
  - æ”¯æŒç¡¬ä»¶åŠ é€Ÿ
  - æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼

#### ç§»åŠ¨å¹³å°ï¼ˆAndroid/iOSï¼‰
- **ä½¿ç”¨æ’ä»¶**: `video_player`
- **ä¼˜åŠ¿**:
  - Flutter å®˜æ–¹æ’ä»¶
  - ç¨³å®šæ€§é«˜
  - åŸç”Ÿæ€§èƒ½

### æ¶æ„è®¾è®¡

```
lib/widgets/
â”œâ”€â”€ video_background_player.dart           # ç»Ÿä¸€æ¥å£ï¼ˆæ ¹æ®å¹³å°è‡ªåŠ¨é€‰æ‹©ï¼‰
â”œâ”€â”€ video_background_player_desktop.dart   # æ¡Œé¢å®ç°ï¼ˆmedia_kitï¼‰
â””â”€â”€ video_background_player_mobile.dart    # ç§»åŠ¨å®ç°ï¼ˆvideo_playerï¼‰
```

### æœåŠ¡å±‚å‡çº§

#### WindowBackgroundService
- æ–°å¢ `WindowBackgroundType` æšä¸¾ï¼ˆimage/videoï¼‰
- æ–°å¢ `mediaPath` å±æ€§æ›¿ä»£ `imagePath`
- è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶ç±»å‹
- å‘åå…¼å®¹æ—§ç‰ˆæœ¬é…ç½®

#### PlayerBackgroundService
- æ–°å¢ `PlayerBackgroundType.video` ç±»å‹
- æ–°å¢ `mediaPath` å±æ€§
- æ”¯æŒå›¾ç‰‡å’Œè§†é¢‘çš„ç»Ÿä¸€ç®¡ç†
- å‘åå…¼å®¹

## ğŸ“¦ ä¾èµ–åŒ…

å·²æ·»åŠ ä»¥ä¸‹ä¾èµ–åˆ° `pubspec.yaml`ï¼š

```yaml
dependencies:
  # ç§»åŠ¨å¹³å°è§†é¢‘æ’­æ”¾å™¨
  video_player: ^2.9.2
  
  # æ¡Œé¢å¹³å°è§†é¢‘æ’­æ”¾å™¨
  media_kit: ^1.1.11
  media_kit_video: ^1.2.5
  media_kit_libs_windows_video: ^1.0.9
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. çª—å£èƒŒæ™¯ï¼ˆFluent UI - Windowsï¼‰

1. è¿›å…¥ **è®¾ç½® â†’ å¤–è§‚ â†’ çª—å£èƒŒæ™¯**
2. å¼€å¯"å¯ç”¨çª—å£èƒŒæ™¯"å¼€å…³ï¼ˆéœ€è¦èµåŠ©ç”¨æˆ·æƒé™ï¼‰
3. ç‚¹å‡»"é€‰æ‹©å›¾ç‰‡/è§†é¢‘"æŒ‰é’®
4. é€‰æ‹©å›¾ç‰‡æˆ–è§†é¢‘æ–‡ä»¶
5. è°ƒèŠ‚æ¨¡ç³Šç¨‹åº¦å’Œä¸é€æ˜åº¦

### 2. æ’­æ”¾å™¨èƒŒæ™¯

1. è¿›å…¥ **è®¾ç½® â†’ æ’­æ”¾å™¨ â†’ æ’­æ”¾å™¨èƒŒæ™¯**
2. é€‰æ‹©èƒŒæ™¯ç±»å‹ï¼š
   - è‡ªé€‚åº”èƒŒæ™¯
   - çº¯è‰²èƒŒæ™¯
   - å›¾ç‰‡èƒŒæ™¯ï¼ˆèµåŠ©ç‹¬äº«ï¼‰
   - è§†é¢‘èƒŒæ™¯ï¼ˆèµåŠ©ç‹¬äº«ï¼‰
3. å¯¹äºå›¾ç‰‡/è§†é¢‘èƒŒæ™¯ï¼Œç‚¹å‡»"é€‰æ‹©å›¾ç‰‡/è§†é¢‘"
4. è°ƒèŠ‚æ¨¡ç³Šç¨‹åº¦

## âš™ï¸ åˆå§‹åŒ–

åœ¨ `main.dart` ä¸­å·²è‡ªåŠ¨åˆå§‹åŒ– media_kitï¼š

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // åˆå§‹åŒ– media_kitï¼ˆç”¨äºæ¡Œé¢å¹³å°è§†é¢‘èƒŒæ™¯ï¼‰
  MediaKit.ensureInitialized();
  
  // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
}
```

## ğŸ”„ å‘åå…¼å®¹

- âœ… è‡ªåŠ¨æ£€æµ‹å¹¶è¿ç§»æ—§ç‰ˆæœ¬çš„å›¾ç‰‡è·¯å¾„é…ç½®
- âœ… ä¿ç•™ `imagePath` getter ä½œä¸ºå…¼å®¹æ¥å£
- âœ… æ—§çš„ `setImagePath()` æ–¹æ³•ä»ç„¶å¯ç”¨
- âœ… SharedPreferences é”®åå…¼å®¹

## ğŸ¨ UI æ›´æ–°

### WindowBackgroundDialog
- æŒ‰é’®å›¾æ ‡æ ¹æ®åª’ä½“ç±»å‹åŠ¨æ€æ˜¾ç¤ºï¼ˆå›¾ç‰‡/è§†é¢‘ï¼‰
- é¢„è§ˆåŒºæ˜¾ç¤ºè§†é¢‘æ–‡ä»¶åå’Œå›¾æ ‡
- æç¤ºæ–‡æ¡ˆæ›´æ–°ä¸º"å›¾ç‰‡æˆ–è§†é¢‘"

### PlayerBackgroundDialog
- æ–°å¢"è§†é¢‘èƒŒæ™¯"å•é€‰é¡¹
- Fluent UI å’Œ Material UI ä¸¤ç§ç•Œé¢é£æ ¼å‡å·²æ›´æ–°
- èµåŠ©ç”¨æˆ·æ ‡è¯†æ˜¾ç¤º

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `lib/widgets/video_background_player.dart` - ç»Ÿä¸€æ¥å£
- `lib/widgets/video_background_player_desktop.dart` - æ¡Œé¢å®ç°
- `lib/widgets/video_background_player_mobile.dart` - ç§»åŠ¨å®ç°

### ä¿®æ”¹æ–‡ä»¶
- `lib/services/window_background_service.dart` - æ”¯æŒè§†é¢‘
- `lib/services/player_background_service.dart` - æ”¯æŒè§†é¢‘
- `lib/pages/settings_page/window_background_dialog.dart` - UI æ›´æ–°
- `lib/pages/settings_page/player_background_dialog.dart` - UI æ›´æ–°
- `lib/layouts/fluent_main_layout.dart` - æ¸²æŸ“è§†é¢‘èƒŒæ™¯
- `lib/pages/player_components/player_background.dart` - æ¸²æŸ“è§†é¢‘èƒŒæ™¯
- `lib/pages/mobile_player_components/mobile_player_background.dart` - æ¸²æŸ“è§†é¢‘èƒŒæ™¯
- `lib/main.dart` - åˆå§‹åŒ– media_kit
- `pubspec.yaml` - æ·»åŠ ä¾èµ–

## ğŸ› æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½è€ƒè™‘**
   - è§†é¢‘æ–‡ä»¶ä¼šå ç”¨è¾ƒå¤šå†…å­˜å’Œ CPU
   - å»ºè®®ä½¿ç”¨åˆ†è¾¨ç‡é€‚ä¸­çš„è§†é¢‘ï¼ˆ1080p ä»¥ä¸‹ï¼‰
   - è§†é¢‘ä¼šè‡ªåŠ¨å¾ªç¯æ’­æ”¾å’Œé™éŸ³

2. **æ–‡ä»¶å¤§å°**
   - å»ºè®®è§†é¢‘æ–‡ä»¶ä¸è¶…è¿‡ 50MB
   - è¿‡å¤§çš„æ–‡ä»¶å¯èƒ½å¯¼è‡´åŠ è½½ç¼“æ…¢

3. **æ ¼å¼å…¼å®¹æ€§**
   - Windows å¹³å°æ¨èä½¿ç”¨ MP4 (H.264) æ ¼å¼
   - Android å¹³å°æ¨èä½¿ç”¨ MP4 æ ¼å¼
   - æŸäº›ç‰¹æ®Šç¼–ç çš„è§†é¢‘å¯èƒ½ä¸æ”¯æŒ

4. **èµåŠ©ç”¨æˆ·åŠŸèƒ½**
   - å›¾ç‰‡å’Œè§†é¢‘èƒŒæ™¯ä¸ºèµåŠ©ç”¨æˆ·ç‹¬äº«åŠŸèƒ½
   - éèµåŠ©ç”¨æˆ·åªèƒ½ä½¿ç”¨è‡ªé€‚åº”å’Œçº¯è‰²èƒŒæ™¯

## ğŸ”§ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„è§†é¢‘æ ¼å¼æ”¯æŒ

åœ¨æœåŠ¡ç±»ä¸­ä¿®æ”¹ `isVideoFile()` æ–¹æ³•ï¼š

```dart
bool isVideoFile(String path) {
  final ext = path.toLowerCase().split('.').last;
  return ['mp4', 'mov', 'avi', 'mkv', 'webm', 'm4v', 'your_format'].contains(ext);
}
```

### è‡ªå®šä¹‰è§†é¢‘æ’­æ”¾å™¨

å¦‚éœ€è‡ªå®šä¹‰è§†é¢‘æ’­æ”¾å™¨ï¼Œä¿®æ”¹å¯¹åº”å¹³å°çš„å®ç°æ–‡ä»¶ï¼š
- æ¡Œé¢: `video_background_player_desktop.dart`
- ç§»åŠ¨: `video_background_player_mobile.dart`

## âœ… æµ‹è¯•å»ºè®®

1. æµ‹è¯•ä¸åŒæ ¼å¼çš„å›¾ç‰‡å’Œè§†é¢‘
2. æµ‹è¯•æ¨¡ç³Šæ•ˆæœå’Œä¸é€æ˜åº¦è°ƒèŠ‚
3. æµ‹è¯•è§†é¢‘å¾ªç¯æ’­æ”¾
4. æµ‹è¯•è·¨å¹³å°å…¼å®¹æ€§ï¼ˆWindows/Android/macOS/Linuxï¼‰
5. æµ‹è¯•å†…å­˜å ç”¨æƒ…å†µ
6. æµ‹è¯•åˆ‡æ¢èƒŒæ™¯ç±»å‹çš„æµç•…æ€§

## ğŸ“„ è®¸å¯è¯

æœ¬åŠŸèƒ½éµå¾ªé¡¹ç›®åŸæœ‰è®¸å¯è¯ã€‚

---

**å®Œæˆæ—¥æœŸ**: 2024-11-22  
**ç‰ˆæœ¬**: 1.0.7+5

